!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.reduxStateSync=t():e.reduxStateSync=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=4)}([function(e,t,n){"use strict";(function(e){function r(e){return!(!e||"function"!=typeof e.then)}function o(e){return e||(e=0),new Promise(function(t){return setTimeout(t,e)})}function i(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function a(e){e||(e=5);for(var t="",n="abcdefghijklmnopqrstuvwxzy0123456789",r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*n.length));return t}function u(){var e=(new Date).getTime();return e===s?(c++,1e3*e+c):(s=e,c=0,1e3*e)}t.a=r,t.d=o,t.f=i,t.e=a,t.c=u,n.d(t,"b",function(){return f});var s=0,c=0,f="[object process]"===Object.prototype.toString.call(void 0!==e?e:0)}).call(t,n(10))},function(e,t,n){"use strict";function r(e){return e||(e={}),e=JSON.parse(JSON.stringify(e)),void 0===e.webWorkerSupport&&(e.webWorkerSupport=!0),e.idb||(e.idb={}),e.idb.ttl||(e.idb.ttl=45e3),e.idb.fallbackInterval||(e.idb.fallbackInterval=150),e.localstorage||(e.localstorage={}),e.localstorage.removeTimeout||(e.localstorage.removeTimeout=6e4),e.node||(e.node={}),e.node.ttl||(e.node.ttl=12e4),void 0===e.node.useFastPath&&(e.node.useFastPath=!0),e}t.a=r},function(e,t,n){"use strict";function r(){return(new Date).getTime()}var o=function(e){function t(){for(var t=r()-e,i=n[Symbol.iterator]();;){var a=i.next().value;if(!a)return;if(!(o.get(a)<t))return;o.delete(a),n.delete(a)}}var n=new Set,o=new Map;this.has=n.has.bind(n),this.add=function(e){o.set(e,r()),n.add(e),t()},this.clear=function(){n.clear(),o.clear()}};t.a=o},function(e,t,n){"use strict";function r(e,t,n){var r=e.method.microSeconds(),o={time:r,type:t,data:n};return(e._prepP?e._prepP:Promise.resolve()).then(function(){return e.method.postMessage(e._state,o)})}function o(e){var t=e.method.create(e.name,e.options);n.i(f.a)(t)?(e._prepP=t,t.then(function(t){e._state=t})):e._state=t}function i(e){return e._addEL.message.length>0||e._addEL.internal.length>0}function a(e,t,n){e._addEL[t].push(n),s(e)}function u(e,t,n){e._addEL[t]=e._addEL[t].filter(function(e){return e!==n}),c(e)}function s(e){if(!e._iL&&i(e)){var t=function(t){e._addEL[t.type].forEach(function(e){t.time>=e.time&&e.fn(t.data)})},n=e.method.microSeconds();e._prepP?e._prepP.then(function(){e._iL=!0,e.method.onMessage(e._state,t,n)}):(e._iL=!0,e.method.onMessage(e._state,t,n))}}function c(e){if(e._iL&&!i(e)){e._iL=!1;var t=e.method.microSeconds();e.method.onMessage(e._state,null,t)}}Object.defineProperty(t,"__esModule",{value:!0});var f=n(0),d=n(5),l=n(1),m=function(e,t){this.name=e,p&&(t=p),this.options=n.i(l.a)(t),this.method=n.i(d.a)(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._befC=[],this._prepP=null,o(this)};m._pubkey=!0,m.clearNodeFolder=function(e){e=n.i(l.a)(e);var t=n.i(d.a)(e);return"node"===t.type?t.clearNodeFolder().then(function(){return!0}):Promise.resolve(!1)};var p;m.enforceOptions=function(e){p=e},m.prototype={postMessage:function(e){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed");return r(this,"message",e)},postInternal:function(e){return r(this,"internal",e)},set onmessage(e){var t=this.method.microSeconds(),n={time:t,fn:e};u(this,"message",this._onML),e&&"function"==typeof e?(this._onML=n,a(this,"message",n)):this._onML=null},addEventListener:function(e,t){a(this,e,{time:this.method.microSeconds(),fn:t})},removeEventListener:function(e,t){u(this,e,this._addEL[e].find(function(e){return e.fn===t}))},close:function(){var e=this;if(!this.closed){this.closed=!0;var t=this._prepP?this._prepP:Promise.resolve();return this._onML=null,this._addEL.message=[],t.then(function(){return Promise.all(e._befC.map(function(e){return e()}))}).then(function(){return e.method.close(e._state)})}},get type(){return this.method.type}},t.default=m},function(e,t,n){"use strict";function r(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function o(){return""+r()+r()+"-"+r()+"-"+r()+"-"+r()+"-"+r()+r()+r()}function i(e){var t=e;return t.$uuid=o(),t.$wuid=g,t}function a(e){var t=e.predicate,n=e.blacklist,r=e.whitelist,o=function(){return!0};return t&&"function"==typeof t?o=t:Array.isArray(n)?o=function(e){return n.indexOf(e)<0}:Array.isArray(r)&&(o=function(e){return r.indexOf(e)>=0}),o}function u(e){return!!e.$isSync}function s(e){var t=e.channel,n=e.dispatch,r=e.allowed,o=!1,i={};t.onmessage=function(e){if(e.$wuid!==g&&e.type!==p&&e.$uuid&&e.$uuid!==d)if(e.type!==l||i[e.$wuid]){if(e.type===m&&!i[e.$wuid])return void(o||(o=!0,n(w(e.payload))));r(e.type)&&(d=e.$uuid,n(Object.assign(e,{$isSync:!0})))}else i[e.$wuid]=!0,n(b())}}Object.defineProperty(t,"__esModule",{value:!0}),t.initStateWithPrevTab=t.withReduxStateSync=t.createReduxStateSync=t.createStateSyncMiddleware=void 0,t.generateUuidForAction=i,t.isActionAllowed=a,t.isActionSynced=u,t.createMessageListener=s;var c=n(3),f=function(e){return e&&e.__esModule?e:{default:e}}(c),d=0,l="&_GET_INIT_STATE",m="&_SEND_INIT_STATE",p="&_RECEIVE_INIT_STATE",h={channel:"redux_state_sync",predicate:null,blacklist:[],whitelist:[],broadcastChannelOption:null,prepareState:function(e){return e}},v=function(){return{type:l}},b=function(){return{type:m}},w=function(e){return{type:p,payload:e}},g=o(),y=!1,S=(t.createStateSyncMiddleware=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,t=a(e),n=new f.default(e.channel,e.broadcastChannelOption),r=e.prepareState||h.prepareState;return function(e){var o=e.getState,a=e.dispatch;return function(e){return function(u){if(y||(y=!0,s({channel:n,dispatch:a,allowed:t})),u&&!u.$uuid){var c=i(u);d=c.$uuid;try{if(u.type===m)return o()&&(c.payload=r(o()),n.postMessage(c)),e(u);(t(c.type)||u.type===l)&&n.postMessage(c)}catch(e){console.error("Your browser doesn't support cross tab communication")}}return e(Object.assign(u,{$isSync:void 0!==u.$isSync&&u.$isSync}))}}}},t.createReduxStateSync=function(e){var t=e.prepareState;return function(e){return function(n,r){var o=n;return r.type===p&&(o=t(r.payload)),e(o,r)}}});t.withReduxStateSync=S({prepareState:function(e){return e}}),t.initStateWithPrevTab=function(e){(0,e.dispatch)(v())}},function(e,t,n){"use strict";function r(e){if(e.type){if("simulate"===e.type)return u.a;var t=c.find(function(t){return t.type===e.type});if(t)return t;throw new Error("method-type "+e.type+" not found")}var n=c;e.webWorkerSupport||s.b||(n=c.filter(function(e){return"idb"!==e.type}));var r=n.find(function(e){return e.canBeUsed()});if(r)return r;throw new Error("No useable methode found:"+JSON.stringify(c.map(function(e){return e.type})))}t.a=r;var o=n(8),i=n(6),a=n(7),u=n(9),s=n(0),c=[o.a,i.a,a.a];if(s.b){var f=n(11);"function"==typeof f.canBeUsed&&c.push(f)}},function(e,t,n){"use strict";function r(){return"undefined"!=typeof indexedDB?indexedDB:void 0!==window.mozIndexedDB?window.mozIndexedDB:void 0!==window.webkitIndexedDB?window.webkitIndexedDB:void 0!==window.msIndexedDB&&window.msIndexedDB}function o(e){var t=r(),n=k+e,o=t.open(n,1);return o.onupgradeneeded=function(e){e.target.result.createObjectStore(T,{keyPath:"id",autoIncrement:!0})},new Promise(function(e,t){o.onerror=function(e){return t(e)},o.onsuccess=function(){e(o.result)}})}function i(e,t,n){var r=(new Date).getTime(),o={uuid:t,time:r,data:n},i=e.transaction([T],"readwrite");return new Promise(function(e,t){i.oncomplete=function(){return e()},i.onerror=function(e){return t(e)},i.objectStore(T).add(o)})}function a(e,t){var n=e.transaction(T).objectStore(T),r=[],o=IDBKeyRange.bound(t+1,1/0);return new Promise(function(e){n.openCursor(o).onsuccess=function(t){var n=t.target.result;n?(r.push(n.value),n.continue()):e(r)}})}function u(e,t){var n=e.transaction([T],"readwrite").objectStore(T).delete(t);return new Promise(function(e){n.onsuccess=function(){return e()}})}function s(e,t){var n=(new Date).getTime()-t,r=e.transaction(T).objectStore(T),o=[];return new Promise(function(e){r.openCursor().onsuccess=function(t){var r=t.target.result;if(r){var i=r.value;if(!(i.time<n))return void e(o);o.push(i),r.continue()}else e(o)}})}function c(e,t){return s(e,t).then(function(t){return Promise.all(t.map(function(t){return u(e,t.id)}))})}function f(e,t){return t=n.i(S.a)(t),o(e).then(function(r){var o={closed:!1,lastCursorId:0,channelName:e,options:t,uuid:n.i(g.e)(10),eMIs:new y.a(2*t.idb.ttl),writeBlockPromise:Promise.resolve(),messagesCallback:null,readQueuePromises:[],db:r};return d(o),o})}function d(e){if(!e.closed)return m(e).then(function(){return n.i(g.d)(e.options.idb.fallbackInterval)}).then(function(){return d(e)})}function l(e,t){return e.uuid!==t.uuid&&(!t.eMIs.has(e.id)&&!(e.data.time<t.messagesCallbackTime))}function m(e){return e.closed?Promise.resolve():e.messagesCallback?a(e.db,e.lastCursorId).then(function(t){return t.filter(function(e){return!!e}).map(function(t){return t.id>e.lastCursorId&&(e.lastCursorId=t.id),t}).filter(function(t){return l(t,e)}).sort(function(e,t){return e.time-t.time}).forEach(function(t){e.messagesCallback&&(e.eMIs.add(t.id),e.messagesCallback(t.data))}),Promise.resolve()}):Promise.resolve()}function p(e){e.closed=!0,e.db.close()}function h(e,t){return e.writeBlockPromise=e.writeBlockPromise.then(function(){return i(e.db,e.uuid,t)}).then(function(){0===n.i(g.f)(0,10)&&c(e.db,e.options.idb.ttl)}),e.writeBlockPromise}function v(e,t,n){e.messagesCallbackTime=n,e.messagesCallback=t,m(e)}function b(){return!g.b&&!!r()}function w(e){return 2*e.idb.fallbackInterval}var g=n(0),y=n(2),S=n(1),_=g.c,k="pubkey.broadcast-channel-0-",T="messages";t.a={create:f,close:p,onMessage:v,postMessage:h,canBeUsed:b,type:"idb",averageResponseTime:w,microSeconds:_}},function(e,t,n){"use strict";function r(){var e;if("undefined"==typeof window)return null;try{e=window.localStorage,e=window["ie8-eventlistener/storage"]||window.localStorage}catch(e){}return e}function o(e){return b+e}function i(e,t){return new Promise(function(i){n.i(h.d)().then(function(){var a=o(e.channelName),u={token:n.i(h.e)(10),time:(new Date).getTime(),data:t,uuid:e.uuid},s=JSON.stringify(u);r().setItem(a,s);var c=document.createEvent("Event");c.initEvent("storage",!0,!0),c.key=a,c.newValue=s,window.dispatchEvent(c),i()})})}function a(e,t){var n=o(e),r=function(e){e.key===n&&t(JSON.parse(e.newValue))};return window.addEventListener("storage",r),r}function u(e){window.removeEventListener("storage",e)}function s(e,t){if(t=n.i(p.a)(t),!d())throw new Error("BroadcastChannel: localstorage cannot be used");var r=n.i(h.e)(10),o=new m.a(t.localstorage.removeTimeout),i={channelName:e,uuid:r,eMIs:o};return i.listener=a(e,function(e){i.messagesCallback&&e.uuid!==r&&e.token&&!o.has(e.token)&&(e.data.time&&e.data.time<i.messagesCallbackTime||(o.add(e.token),i.messagesCallback(e.data)))}),i}function c(e){u(e.listener)}function f(e,t,n){e.messagesCallbackTime=n,e.messagesCallback=t}function d(){if(h.b)return!1;var e=r();if(!e)return!1;try{var t="__broadcastchannel_check";e.setItem(t,"works"),e.removeItem(t)}catch(e){return!1}return!0}function l(){return 120}var m=n(2),p=n(1),h=n(0),v=h.c,b="pubkey.broadcastChannel-";t.a={create:s,close:c,onMessage:f,postMessage:i,canBeUsed:d,type:"localstorage",averageResponseTime:l,microSeconds:v}},function(e,t,n){"use strict";function r(e){var t={messagesCallback:null,bc:new BroadcastChannel(e),subFns:[]};return t.bc.onmessage=function(e){t.messagesCallback&&t.messagesCallback(e.data)},t}function o(e){e.bc.close(),e.subFns=[]}function i(e,t){e.bc.postMessage(t,!1)}function a(e,t){e.messagesCallback=t}function u(){if(c.b&&"undefined"==typeof window)return!1;if("function"==typeof BroadcastChannel){if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0}return!1}function s(){return 150}var c=n(0),f=c.c;t.a={create:r,close:o,onMessage:a,postMessage:i,canBeUsed:u,type:"native",averageResponseTime:s,microSeconds:f}},function(e,t,n){"use strict";function r(e){var t={name:e,messagesCallback:null};return d.add(t),t}function o(e){d.delete(e)}function i(e,t){return new Promise(function(n){return setTimeout(function(){Array.from(d).filter(function(t){return t.name===e.name}).filter(function(t){return t!==e}).filter(function(e){return!!e.messagesCallback}).forEach(function(e){return e.messagesCallback(t)}),n()},5)})}function a(e,t){e.messagesCallback=t}function u(){return!0}function s(){return 5}var c=n(0),f=c.c,d=new Set;t.a={create:r,close:o,onMessage:a,postMessage:i,canBeUsed:u,type:"simulate",averageResponseTime:s,microSeconds:f}},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(e){if(f===setTimeout)return setTimeout(e,0);if((f===n||!f)&&setTimeout)return f=setTimeout,setTimeout(e,0);try{return f(e,0)}catch(t){try{return f.call(null,e,0)}catch(t){return f.call(this,e,0)}}}function i(e){if(d===clearTimeout)return clearTimeout(e);if((d===r||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(e);try{return d(e)}catch(t){try{return d.call(null,e)}catch(t){return d.call(this,e)}}}function a(){h&&m&&(h=!1,m.length?p=m.concat(p):v=-1,p.length&&u())}function u(){if(!h){var e=o(a);h=!0;for(var t=p.length;t;){for(m=p,p=[];++v<t;)m&&m[v].run();v=-1,t=p.length}m=null,h=!1,i(e)}}function s(e,t){this.fun=e,this.array=t}function c(){}var f,d,l=e.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:n}catch(e){f=n}try{d="function"==typeof clearTimeout?clearTimeout:r}catch(e){d=r}}();var m,p=[],h=!1,v=-1;l.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];p.push(new s(e,t)),1!==p.length||h||o(u)},s.prototype.run=function(){this.fun.apply(null,this.array)},l.title="browser",l.browser=!0,l.env={},l.argv=[],l.version="",l.versions={},l.on=c,l.addListener=c,l.once=c,l.off=c,l.removeListener=c,l.removeAllListeners=c,l.emit=c,l.prependListener=c,l.prependOnceListener=c,l.listeners=function(e){return[]},l.binding=function(e){throw new Error("process.binding is not supported")},l.cwd=function(){return"/"},l.chdir=function(e){throw new Error("process.chdir is not supported")},l.umask=function(){return 0}},function(e,t){}])});
//# sourceMappingURL=syncState.umd.min.js.map