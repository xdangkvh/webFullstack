{"ast":null,"code":"import { isPromise } from './util.js';\nimport { chooseMethod } from './method-chooser.js';\nimport { fillOptionsWithDefaults } from './options.js';\n\nvar BroadcastChannel = function BroadcastChannel(name, options) {\n  this.name = name;\n\n  if (ENFORCED_OPTIONS) {\n    options = ENFORCED_OPTIONS;\n  }\n\n  this.options = fillOptionsWithDefaults(options);\n  this.method = chooseMethod(this.options); // isListening\n\n  this._iL = false;\n  /**\n   * _onMessageListener\n   * setting onmessage twice,\n   * will overwrite the first listener\n   */\n\n  this._onML = null;\n  /**\n   * _addEventListeners\n   */\n\n  this._addEL = {\n    message: [],\n    internal: []\n  };\n  /**\n   * _beforeClose\n   * array of promises that will be awaited\n   * before the channel is closed\n   */\n\n  this._befC = [];\n  /**\n   * _preparePromise\n   */\n\n  this._prepP = null;\n\n  _prepareChannel(this);\n}; // STATICS\n\n/**\n * used to identify if someone overwrites\n * window.BroadcastChannel with this\n * See methods/native.js\n */\n\n\nBroadcastChannel._pubkey = true;\n/**\n * clears the tmp-folder if is node\n * @return {Promise<boolean>} true if has run, false if not node\n */\n\nBroadcastChannel.clearNodeFolder = function (options) {\n  options = fillOptionsWithDefaults(options);\n  var method = chooseMethod(options);\n\n  if (method.type === 'node') {\n    return method.clearNodeFolder().then(function () {\n      return true;\n    });\n  } else {\n    return Promise.resolve(false);\n  }\n};\n/**\n * if set, this method is enforced,\n * no mather what the options are\n */\n\n\nvar ENFORCED_OPTIONS;\n\nBroadcastChannel.enforceOptions = function (options) {\n  ENFORCED_OPTIONS = options;\n}; // PROTOTYPE\n\n\nBroadcastChannel.prototype = {\n  postMessage: function postMessage(msg) {\n    if (this.closed) {\n      throw new Error('BroadcastChannel.postMessage(): ' + 'Cannot post message after channel has closed');\n    }\n\n    return _post(this, 'message', msg);\n  },\n  postInternal: function postInternal(msg) {\n    return _post(this, 'internal', msg);\n  },\n\n  set onmessage(fn) {\n    var time = this.method.microSeconds();\n    var listenObj = {\n      time: time,\n      fn: fn\n    };\n\n    _removeListenerObject(this, 'message', this._onML);\n\n    if (fn && typeof fn === 'function') {\n      this._onML = listenObj;\n\n      _addListenerObject(this, 'message', listenObj);\n    } else {\n      this._onML = null;\n    }\n  },\n\n  addEventListener: function addEventListener(type, fn) {\n    var time = this.method.microSeconds();\n    var listenObj = {\n      time: time,\n      fn: fn\n    };\n\n    _addListenerObject(this, type, listenObj);\n  },\n  removeEventListener: function removeEventListener(type, fn) {\n    var obj = this._addEL[type].find(function (obj) {\n      return obj.fn === fn;\n    });\n\n    _removeListenerObject(this, type, obj);\n  },\n  close: function close() {\n    var _this = this;\n\n    if (this.closed) return;\n    this.closed = true;\n    var awaitPrepare = this._prepP ? this._prepP : Promise.resolve();\n    this._onML = null;\n    this._addEL.message = [];\n    return awaitPrepare.then(function () {\n      return Promise.all(_this._befC.map(function (fn) {\n        return fn();\n      }));\n    }).then(function () {\n      return _this.method.close(_this._state);\n    });\n  },\n\n  get type() {\n    return this.method.type;\n  }\n\n};\n\nfunction _post(broadcastChannel, type, msg) {\n  var time = broadcastChannel.method.microSeconds();\n  var msgObj = {\n    time: time,\n    type: type,\n    data: msg\n  };\n  var awaitPrepare = broadcastChannel._prepP ? broadcastChannel._prepP : Promise.resolve();\n  return awaitPrepare.then(function () {\n    return broadcastChannel.method.postMessage(broadcastChannel._state, msgObj);\n  });\n}\n\nfunction _prepareChannel(channel) {\n  var maybePromise = channel.method.create(channel.name, channel.options);\n\n  if (isPromise(maybePromise)) {\n    channel._prepP = maybePromise;\n    maybePromise.then(function (s) {\n      // used in tests to simulate slow runtime\n\n      /*if (channel.options.prepareDelay) {\n           await new Promise(res => setTimeout(res, this.options.prepareDelay));\n      }*/\n      channel._state = s;\n    });\n  } else {\n    channel._state = maybePromise;\n  }\n}\n\nfunction _hasMessageListeners(channel) {\n  if (channel._addEL.message.length > 0) return true;\n  if (channel._addEL.internal.length > 0) return true;\n  return false;\n}\n\nfunction _addListenerObject(channel, type, obj) {\n  channel._addEL[type].push(obj);\n\n  _startListening(channel);\n}\n\nfunction _removeListenerObject(channel, type, obj) {\n  channel._addEL[type] = channel._addEL[type].filter(function (o) {\n    return o !== obj;\n  });\n\n  _stopListening(channel);\n}\n\nfunction _startListening(channel) {\n  if (!channel._iL && _hasMessageListeners(channel)) {\n    // someone is listening, start subscribing\n    var listenerFn = function listenerFn(msgObj) {\n      channel._addEL[msgObj.type].forEach(function (obj) {\n        if (msgObj.time >= obj.time) {\n          obj.fn(msgObj.data);\n        }\n      });\n    };\n\n    var time = channel.method.microSeconds();\n\n    if (channel._prepP) {\n      channel._prepP.then(function () {\n        channel._iL = true;\n        channel.method.onMessage(channel._state, listenerFn, time);\n      });\n    } else {\n      channel._iL = true;\n      channel.method.onMessage(channel._state, listenerFn, time);\n    }\n  }\n}\n\nfunction _stopListening(channel) {\n  if (channel._iL && !_hasMessageListeners(channel)) {\n    // noone is listening, stop subscribing\n    channel._iL = false;\n    var time = channel.method.microSeconds();\n    channel.method.onMessage(channel._state, null, time);\n  }\n}\n\nexport default BroadcastChannel;","map":{"version":3,"sources":["C:/Users/ADMIN/Documents/webFullstack/frontendReactJS/Frontend-React.JS-QuickStart/node_modules/broadcast-channel/dist/es/index.js"],"names":["isPromise","chooseMethod","fillOptionsWithDefaults","BroadcastChannel","name","options","ENFORCED_OPTIONS","method","_iL","_onML","_addEL","message","internal","_befC","_prepP","_prepareChannel","_pubkey","clearNodeFolder","type","then","Promise","resolve","enforceOptions","prototype","postMessage","msg","closed","Error","_post","postInternal","onmessage","fn","time","microSeconds","listenObj","_removeListenerObject","_addListenerObject","addEventListener","removeEventListener","obj","find","close","_this","awaitPrepare","all","map","_state","broadcastChannel","msgObj","data","channel","maybePromise","create","s","_hasMessageListeners","length","push","_startListening","filter","o","_stopListening","listenerFn","forEach","onMessage"],"mappings":"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","sourcesContent":["import { isPromise } from './util.js';\nimport { chooseMethod } from './method-chooser.js';\nimport { fillOptionsWithDefaults } from './options.js';\n\nvar BroadcastChannel = function BroadcastChannel(name, options) {\n  this.name = name;\n\n  if (ENFORCED_OPTIONS) {\n    options = ENFORCED_OPTIONS;\n  }\n\n  this.options = fillOptionsWithDefaults(options);\n  this.method = chooseMethod(this.options); // isListening\n\n  this._iL = false;\n  /**\n   * _onMessageListener\n   * setting onmessage twice,\n   * will overwrite the first listener\n   */\n\n  this._onML = null;\n  /**\n   * _addEventListeners\n   */\n\n  this._addEL = {\n    message: [],\n    internal: []\n  };\n  /**\n   * _beforeClose\n   * array of promises that will be awaited\n   * before the channel is closed\n   */\n\n  this._befC = [];\n  /**\n   * _preparePromise\n   */\n\n  this._prepP = null;\n\n  _prepareChannel(this);\n}; // STATICS\n\n/**\n * used to identify if someone overwrites\n * window.BroadcastChannel with this\n * See methods/native.js\n */\n\n\nBroadcastChannel._pubkey = true;\n/**\n * clears the tmp-folder if is node\n * @return {Promise<boolean>} true if has run, false if not node\n */\n\nBroadcastChannel.clearNodeFolder = function (options) {\n  options = fillOptionsWithDefaults(options);\n  var method = chooseMethod(options);\n\n  if (method.type === 'node') {\n    return method.clearNodeFolder().then(function () {\n      return true;\n    });\n  } else {\n    return Promise.resolve(false);\n  }\n};\n/**\n * if set, this method is enforced,\n * no mather what the options are\n */\n\n\nvar ENFORCED_OPTIONS;\n\nBroadcastChannel.enforceOptions = function (options) {\n  ENFORCED_OPTIONS = options;\n}; // PROTOTYPE\n\n\nBroadcastChannel.prototype = {\n  postMessage: function postMessage(msg) {\n    if (this.closed) {\n      throw new Error('BroadcastChannel.postMessage(): ' + 'Cannot post message after channel has closed');\n    }\n\n    return _post(this, 'message', msg);\n  },\n  postInternal: function postInternal(msg) {\n    return _post(this, 'internal', msg);\n  },\n\n  set onmessage(fn) {\n    var time = this.method.microSeconds();\n    var listenObj = {\n      time: time,\n      fn: fn\n    };\n\n    _removeListenerObject(this, 'message', this._onML);\n\n    if (fn && typeof fn === 'function') {\n      this._onML = listenObj;\n\n      _addListenerObject(this, 'message', listenObj);\n    } else {\n      this._onML = null;\n    }\n  },\n\n  addEventListener: function addEventListener(type, fn) {\n    var time = this.method.microSeconds();\n    var listenObj = {\n      time: time,\n      fn: fn\n    };\n\n    _addListenerObject(this, type, listenObj);\n  },\n  removeEventListener: function removeEventListener(type, fn) {\n    var obj = this._addEL[type].find(function (obj) {\n      return obj.fn === fn;\n    });\n\n    _removeListenerObject(this, type, obj);\n  },\n  close: function close() {\n    var _this = this;\n\n    if (this.closed) return;\n    this.closed = true;\n    var awaitPrepare = this._prepP ? this._prepP : Promise.resolve();\n    this._onML = null;\n    this._addEL.message = [];\n    return awaitPrepare.then(function () {\n      return Promise.all(_this._befC.map(function (fn) {\n        return fn();\n      }));\n    }).then(function () {\n      return _this.method.close(_this._state);\n    });\n  },\n\n  get type() {\n    return this.method.type;\n  }\n\n};\n\nfunction _post(broadcastChannel, type, msg) {\n  var time = broadcastChannel.method.microSeconds();\n  var msgObj = {\n    time: time,\n    type: type,\n    data: msg\n  };\n  var awaitPrepare = broadcastChannel._prepP ? broadcastChannel._prepP : Promise.resolve();\n  return awaitPrepare.then(function () {\n    return broadcastChannel.method.postMessage(broadcastChannel._state, msgObj);\n  });\n}\n\nfunction _prepareChannel(channel) {\n  var maybePromise = channel.method.create(channel.name, channel.options);\n\n  if (isPromise(maybePromise)) {\n    channel._prepP = maybePromise;\n    maybePromise.then(function (s) {\n      // used in tests to simulate slow runtime\n\n      /*if (channel.options.prepareDelay) {\n           await new Promise(res => setTimeout(res, this.options.prepareDelay));\n      }*/\n      channel._state = s;\n    });\n  } else {\n    channel._state = maybePromise;\n  }\n}\n\nfunction _hasMessageListeners(channel) {\n  if (channel._addEL.message.length > 0) return true;\n  if (channel._addEL.internal.length > 0) return true;\n  return false;\n}\n\nfunction _addListenerObject(channel, type, obj) {\n  channel._addEL[type].push(obj);\n\n  _startListening(channel);\n}\n\nfunction _removeListenerObject(channel, type, obj) {\n  channel._addEL[type] = channel._addEL[type].filter(function (o) {\n    return o !== obj;\n  });\n\n  _stopListening(channel);\n}\n\nfunction _startListening(channel) {\n  if (!channel._iL && _hasMessageListeners(channel)) {\n    // someone is listening, start subscribing\n    var listenerFn = function listenerFn(msgObj) {\n      channel._addEL[msgObj.type].forEach(function (obj) {\n        if (msgObj.time >= obj.time) {\n          obj.fn(msgObj.data);\n        }\n      });\n    };\n\n    var time = channel.method.microSeconds();\n\n    if (channel._prepP) {\n      channel._prepP.then(function () {\n        channel._iL = true;\n        channel.method.onMessage(channel._state, listenerFn, time);\n      });\n    } else {\n      channel._iL = true;\n      channel.method.onMessage(channel._state, listenerFn, time);\n    }\n  }\n}\n\nfunction _stopListening(channel) {\n  if (channel._iL && !_hasMessageListeners(channel)) {\n    // noone is listening, stop subscribing\n    channel._iL = false;\n    var time = channel.method.microSeconds();\n    channel.method.onMessage(channel._state, null, time);\n  }\n}\n\nexport default BroadcastChannel;"]},"metadata":{},"sourceType":"module"}