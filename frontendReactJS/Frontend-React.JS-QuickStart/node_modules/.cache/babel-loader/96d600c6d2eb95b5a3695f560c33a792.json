{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.initStateWithPrevTab = exports.withReduxStateSync = exports.createReduxStateSync = exports.createStateSyncMiddleware = undefined;\nexports.generateUuidForAction = generateUuidForAction;\nexports.isActionAllowed = isActionAllowed;\nexports.isActionSynced = isActionSynced;\nexports.createMessageListener = createMessageListener;\n\nvar _broadcastChannel = require('broadcast-channel');\n\nvar _broadcastChannel2 = _interopRequireDefault(_broadcastChannel);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar lastUuid = 0;\n/* eslint-env browser */\n\nvar GET_INIT_STATE = '&_GET_INIT_STATE';\nvar SEND_INIT_STATE = '&_SEND_INIT_STATE';\nvar RECEIVE_INIT_STATE = '&_RECEIVE_INIT_STATE';\nvar defaultConfig = {\n  channel: 'redux_state_sync',\n  predicate: null,\n  blacklist: [],\n  whitelist: [],\n  broadcastChannelOption: null,\n  prepareState: function prepareState(state) {\n    return state;\n  }\n};\n\nvar getIniteState = function getIniteState() {\n  return {\n    type: GET_INIT_STATE\n  };\n};\n\nvar sendIniteState = function sendIniteState() {\n  return {\n    type: SEND_INIT_STATE\n  };\n};\n\nvar receiveIniteState = function receiveIniteState(state) {\n  return {\n    type: RECEIVE_INIT_STATE,\n    payload: state\n  };\n};\n\nfunction s4() {\n  return Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);\n}\n\nfunction guid() {\n  return '' + s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();\n} // generate current window unique id\n\n\nvar WINDOW_STATE_SYNC_ID = guid(); // if the message receiver is already created\n\nvar isMessageListenerCreated = false; // export for test\n\nfunction generateUuidForAction(action) {\n  var stampedAction = action;\n  stampedAction.$uuid = guid();\n  stampedAction.$wuid = WINDOW_STATE_SYNC_ID;\n  return stampedAction;\n} // export for test\n\n\nfunction isActionAllowed(_ref) {\n  var predicate = _ref.predicate,\n      blacklist = _ref.blacklist,\n      whitelist = _ref.whitelist;\n\n  var allowed = function allowed() {\n    return true;\n  };\n\n  if (predicate && typeof predicate === 'function') {\n    allowed = predicate;\n  } else if (Array.isArray(blacklist)) {\n    allowed = function allowed(type) {\n      return blacklist.indexOf(type) < 0;\n    };\n  } else if (Array.isArray(whitelist)) {\n    allowed = function allowed(type) {\n      return whitelist.indexOf(type) >= 0;\n    };\n  }\n\n  return allowed;\n} // export for test\n\n\nfunction isActionSynced(action) {\n  return !!action.$isSync;\n} // export for test\n\n\nfunction createMessageListener(_ref2) {\n  var channel = _ref2.channel,\n      dispatch = _ref2.dispatch,\n      allowed = _ref2.allowed;\n  var isSynced = false;\n  var tabs = {};\n  var messageChannel = channel;\n\n  messageChannel.onmessage = function (stampedAction) {\n    // Ignore if this action is triggered by this window\n    if (stampedAction.$wuid === WINDOW_STATE_SYNC_ID) {\n      return;\n    } // IE bug https://stackoverflow.com/questions/18265556/why-does-internet-explorer-fire-the-window-storage-event-on-the-window-that-st\n\n\n    if (stampedAction.type === RECEIVE_INIT_STATE) {\n      return;\n    } // ignore other values that saved to localstorage.\n\n\n    if (stampedAction.$uuid && stampedAction.$uuid !== lastUuid) {\n      if (stampedAction.type === GET_INIT_STATE && !tabs[stampedAction.$wuid]) {\n        tabs[stampedAction.$wuid] = true;\n        dispatch(sendIniteState());\n      } else if (stampedAction.type === SEND_INIT_STATE && !tabs[stampedAction.$wuid]) {\n        if (!isSynced) {\n          isSynced = true;\n          dispatch(receiveIniteState(stampedAction.payload));\n        }\n\n        return;\n      } else if (allowed(stampedAction.type)) {\n        lastUuid = stampedAction.$uuid;\n        dispatch(Object.assign(stampedAction, {\n          $isSync: true\n        }));\n      }\n    }\n  };\n}\n\nvar createStateSyncMiddleware = exports.createStateSyncMiddleware = function createStateSyncMiddleware() {\n  var config = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : defaultConfig;\n  var allowed = isActionAllowed(config);\n  var channel = new _broadcastChannel2.default(config.channel, config.broadcastChannelOption);\n  var prepareState = config.prepareState || defaultConfig.prepareState;\n  return function (_ref3) {\n    var getState = _ref3.getState,\n        dispatch = _ref3.dispatch;\n    return function (next) {\n      return function (action) {\n        // create message receiver\n        if (!isMessageListenerCreated) {\n          isMessageListenerCreated = true;\n          createMessageListener({\n            channel: channel,\n            dispatch: dispatch,\n            allowed: allowed\n          });\n        } // post messages\n\n\n        if (action && !action.$uuid) {\n          var stampedAction = generateUuidForAction(action);\n          lastUuid = stampedAction.$uuid;\n\n          try {\n            if (action.type === SEND_INIT_STATE) {\n              if (getState()) {\n                stampedAction.payload = prepareState(getState());\n                channel.postMessage(stampedAction);\n              }\n\n              return next(action);\n            }\n\n            if (allowed(stampedAction.type) || action.type === GET_INIT_STATE) {\n              channel.postMessage(stampedAction);\n            }\n          } catch (e) {\n            console.error(\"Your browser doesn't support cross tab communication\");\n          }\n        }\n\n        return next(Object.assign(action, {\n          $isSync: typeof action.$isSync === 'undefined' ? false : action.$isSync\n        }));\n      };\n    };\n  };\n};\n\nvar createReduxStateSync = exports.createReduxStateSync = function createReduxStateSync(_ref4) {\n  var prepareState = _ref4.prepareState;\n  return function (appReducer) {\n    return function (state, action) {\n      var initState = state;\n\n      if (action.type === RECEIVE_INIT_STATE) {\n        initState = prepareState(action.payload);\n      }\n\n      return appReducer(initState, action);\n    };\n  };\n}; // init state with other tab's state\n\n\nvar withReduxStateSync = exports.withReduxStateSync = createReduxStateSync({\n  prepareState: function prepareState(state) {\n    return state;\n  }\n});\n\nvar initStateWithPrevTab = exports.initStateWithPrevTab = function initStateWithPrevTab(_ref5) {\n  var dispatch = _ref5.dispatch;\n  dispatch(getIniteState());\n};","map":{"version":3,"sources":["C:/Users/ADMIN/Documents/webFullstack/frontendReactJS/Frontend-React.JS-QuickStart/node_modules/redux-state-sync/dist/syncState.js"],"names":["Object","defineProperty","exports","value","initStateWithPrevTab","withReduxStateSync","createReduxStateSync","createStateSyncMiddleware","undefined","generateUuidForAction","isActionAllowed","isActionSynced","createMessageListener","_broadcastChannel","require","_broadcastChannel2","_interopRequireDefault","obj","__esModule","default","lastUuid","GET_INIT_STATE","SEND_INIT_STATE","RECEIVE_INIT_STATE","defaultConfig","channel","predicate","blacklist","whitelist","broadcastChannelOption","prepareState","state","getIniteState","type","sendIniteState","receiveIniteState","payload","s4","Math","floor","random","toString","substring","guid","WINDOW_STATE_SYNC_ID","isMessageListenerCreated","action","stampedAction","$uuid","$wuid","_ref","allowed","Array","isArray","indexOf","$isSync","_ref2","dispatch","isSynced","tabs","messageChannel","onmessage","assign","config","arguments","length","_ref3","getState","next","postMessage","e","console","error","_ref4","appReducer","initState","_ref5"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.initStateWithPrevTab = exports.withReduxStateSync = exports.createReduxStateSync = exports.createStateSyncMiddleware = undefined;\nexports.generateUuidForAction = generateUuidForAction;\nexports.isActionAllowed = isActionAllowed;\nexports.isActionSynced = isActionSynced;\nexports.createMessageListener = createMessageListener;\n\nvar _broadcastChannel = require('broadcast-channel');\n\nvar _broadcastChannel2 = _interopRequireDefault(_broadcastChannel);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar lastUuid = 0; /* eslint-env browser */\n\nvar GET_INIT_STATE = '&_GET_INIT_STATE';\nvar SEND_INIT_STATE = '&_SEND_INIT_STATE';\nvar RECEIVE_INIT_STATE = '&_RECEIVE_INIT_STATE';\n\nvar defaultConfig = {\n  channel: 'redux_state_sync',\n  predicate: null,\n  blacklist: [],\n  whitelist: [],\n  broadcastChannelOption: null,\n  prepareState: function prepareState(state) {\n    return state;\n  }\n};\n\nvar getIniteState = function getIniteState() {\n  return { type: GET_INIT_STATE };\n};\nvar sendIniteState = function sendIniteState() {\n  return { type: SEND_INIT_STATE };\n};\nvar receiveIniteState = function receiveIniteState(state) {\n  return { type: RECEIVE_INIT_STATE, payload: state };\n};\n\nfunction s4() {\n  return Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);\n}\n\nfunction guid() {\n  return '' + s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();\n}\n\n// generate current window unique id\nvar WINDOW_STATE_SYNC_ID = guid();\n// if the message receiver is already created\nvar isMessageListenerCreated = false;\n// export for test\nfunction generateUuidForAction(action) {\n  var stampedAction = action;\n  stampedAction.$uuid = guid();\n  stampedAction.$wuid = WINDOW_STATE_SYNC_ID;\n  return stampedAction;\n}\n// export for test\nfunction isActionAllowed(_ref) {\n  var predicate = _ref.predicate,\n      blacklist = _ref.blacklist,\n      whitelist = _ref.whitelist;\n\n  var allowed = function allowed() {\n    return true;\n  };\n\n  if (predicate && typeof predicate === 'function') {\n    allowed = predicate;\n  } else if (Array.isArray(blacklist)) {\n    allowed = function allowed(type) {\n      return blacklist.indexOf(type) < 0;\n    };\n  } else if (Array.isArray(whitelist)) {\n    allowed = function allowed(type) {\n      return whitelist.indexOf(type) >= 0;\n    };\n  }\n  return allowed;\n}\n// export for test\nfunction isActionSynced(action) {\n  return !!action.$isSync;\n}\n// export for test\nfunction createMessageListener(_ref2) {\n  var channel = _ref2.channel,\n      dispatch = _ref2.dispatch,\n      allowed = _ref2.allowed;\n\n  var isSynced = false;\n  var tabs = {};\n  var messageChannel = channel;\n  messageChannel.onmessage = function (stampedAction) {\n    // Ignore if this action is triggered by this window\n    if (stampedAction.$wuid === WINDOW_STATE_SYNC_ID) {\n      return;\n    }\n    // IE bug https://stackoverflow.com/questions/18265556/why-does-internet-explorer-fire-the-window-storage-event-on-the-window-that-st\n    if (stampedAction.type === RECEIVE_INIT_STATE) {\n      return;\n    }\n    // ignore other values that saved to localstorage.\n    if (stampedAction.$uuid && stampedAction.$uuid !== lastUuid) {\n      if (stampedAction.type === GET_INIT_STATE && !tabs[stampedAction.$wuid]) {\n        tabs[stampedAction.$wuid] = true;\n        dispatch(sendIniteState());\n      } else if (stampedAction.type === SEND_INIT_STATE && !tabs[stampedAction.$wuid]) {\n        if (!isSynced) {\n          isSynced = true;\n          dispatch(receiveIniteState(stampedAction.payload));\n        }\n        return;\n      } else if (allowed(stampedAction.type)) {\n        lastUuid = stampedAction.$uuid;\n        dispatch(Object.assign(stampedAction, {\n          $isSync: true\n        }));\n      }\n    }\n  };\n}\n\nvar createStateSyncMiddleware = exports.createStateSyncMiddleware = function createStateSyncMiddleware() {\n  var config = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : defaultConfig;\n\n  var allowed = isActionAllowed(config);\n  var channel = new _broadcastChannel2.default(config.channel, config.broadcastChannelOption);\n  var prepareState = config.prepareState || defaultConfig.prepareState;\n\n  return function (_ref3) {\n    var getState = _ref3.getState,\n        dispatch = _ref3.dispatch;\n    return function (next) {\n      return function (action) {\n        // create message receiver\n        if (!isMessageListenerCreated) {\n          isMessageListenerCreated = true;\n          createMessageListener({ channel: channel, dispatch: dispatch, allowed: allowed });\n        }\n        // post messages\n        if (action && !action.$uuid) {\n          var stampedAction = generateUuidForAction(action);\n          lastUuid = stampedAction.$uuid;\n          try {\n            if (action.type === SEND_INIT_STATE) {\n              if (getState()) {\n                stampedAction.payload = prepareState(getState());\n                channel.postMessage(stampedAction);\n              }\n              return next(action);\n            }\n            if (allowed(stampedAction.type) || action.type === GET_INIT_STATE) {\n              channel.postMessage(stampedAction);\n            }\n          } catch (e) {\n            console.error(\"Your browser doesn't support cross tab communication\");\n          }\n        }\n        return next(Object.assign(action, {\n          $isSync: typeof action.$isSync === 'undefined' ? false : action.$isSync\n        }));\n      };\n    };\n  };\n};\n\nvar createReduxStateSync = exports.createReduxStateSync = function createReduxStateSync(_ref4) {\n  var prepareState = _ref4.prepareState;\n  return function (appReducer) {\n    return function (state, action) {\n      var initState = state;\n      if (action.type === RECEIVE_INIT_STATE) {\n        initState = prepareState(action.payload);\n      }\n      return appReducer(initState, action);\n    };\n  };\n};\n\n// init state with other tab's state\nvar withReduxStateSync = exports.withReduxStateSync = createReduxStateSync({\n  prepareState: function prepareState(state) {\n    return state;\n  }\n});\n\nvar initStateWithPrevTab = exports.initStateWithPrevTab = function initStateWithPrevTab(_ref5) {\n  var dispatch = _ref5.dispatch;\n\n  dispatch(getIniteState());\n};"]},"metadata":{},"sourceType":"script"}